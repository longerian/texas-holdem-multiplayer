<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾·å·æ‰‘å…‹å¤šäººç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            font-size: 2em;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .lobby {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        .lobby h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 0.9em;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1em;
        }
        
        .form-group input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; }
        .btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: #fff; }
        .btn-warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: #fff; }
        .btn-danger { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); color: #fff; }
        .btn-secondary { background: rgba(255,255,255,0.2); color: #fff; }
        
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-small { padding: 8px 15px; font-size: 0.85em; }
        
        .btn-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .room-info {
            text-align: center;
            padding: 15px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            margin-bottom: 15px;
        }
        
        .room-code {
            font-size: 1.8em;
            font-weight: bold;
            color: #ffd700;
            letter-spacing: 5px;
        }
        
        /* 6äººåº§ä½ */
        .seats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .seat {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .seat.occupied {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .seat.your-seat {
            border-color: #ffd700;
        }
        
        .seat.ai-seat {
            border-color: #667eea;
        }
        
        .seat.waiting {
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }
        
        .seat .player-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        
        .seat .player-type {
            font-size: 0.8em;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .seat .player-chips {
            color: #ffd700;
            font-size: 0.9em;
        }
        
        .seat .player-status {
            font-size: 0.75em;
            color: #888;
            margin-top: 5px;
        }
        
        .seat .seat-actions {
            margin-top: 10px;
        }
        
        /* æ¸¸æˆç•Œé¢ */
        .game-table {
            display: none;
        }
        
        .game-table.active {
            display: block;
        }
        
        .table {
            background: radial-gradient(ellipse at center, #1a5c2e 0%, #0d3d1a 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px auto;
            border: 8px solid #8b4513;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }
        
        .players-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .game-player {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }
        
        .game-player.current {
            border: 3px solid #ffd700;
            animation: pulse 1s infinite;
        }
        
        .game-player.folded {
            opacity: 0.4;
        }
        
        .game-player.is-ai {
            background: rgba(102, 126, 234, 0.2);
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.8); }
        }
        
        .cards {
            display: flex;
            gap: 3px;
            justify-content: center;
            margin: 8px 0;
        }
        
        .card {
            width: 40px;
            height: 56px;
            background: #fff;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .card.red { color: #e74c3c; }
        .card.black { color: #2c3e50; }
        .card.hidden {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }
        
        .community-cards {
            text-align: center;
            margin: 15px 0;
        }
        
        .community-cards .cards {
            margin: 10px 0;
        }
        
        .pot {
            text-align: center;
            font-size: 1.3em;
            color: #ffd700;
            margin: 10px 0;
        }
        
        .phase-indicator {
            text-align: center;
            color: #aaa;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .controls {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .controls-row {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .call-btn { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: #fff; }
        .raise-btn { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: #fff; }
        .fold-btn { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: #fff !important; }
        .check-btn { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: #fff !important; }
        
        .message {
            text-align: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 10px 0;
        }
        
        /* åŠ æ³¨æ»‘å—å¼¹çª—æ ·å¼ */
        .raise-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .raise-modal-content {
            background: linear-gradient(135deg, #2c3e50 0%, #1a1a2e 100%);
            padding: 25px 30px;
            border-radius: 20px;
            text-align: center;
            min-width: 300px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .raise-title {
            font-size: 1.1em;
            color: #aaa;
            margin-bottom: 10px;
        }
        
        .raise-amount {
            font-size: 2.5em;
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .raise-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #444;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }
        
        .raise-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(155, 89, 182, 0.5);
        }
        
        .raise-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            cursor: pointer;
            border: none;
        }
        
        .raise-range {
            display: flex;
            justify-content: space-between;
            color: #888;
            font-size: 0.85em;
            margin: 10px 0 15px;
        }
        
        .raise-presets {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .raise-preset-btn {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: #fff;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .raise-preset-btn:hover {
            background: rgba(155, 89, 182, 0.5);
            border-color: #9b59b6;
        }
        
        .raise-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .hidden { display: none !important; }
        
        @media (max-width: 768px) {
            h1 { font-size: 1.5em; }
            .seats-container, .players-grid { grid-template-columns: repeat(2, 1fr); }
            .btn { padding: 10px 18px; font-size: 0.9em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸƒ å¾·å·æ‰‘å…‹å¤šäººç‰ˆ</h1>
        
        <!-- å¤§å…ç•Œé¢ -->
        <div id="lobby" class="lobby">
            <h2>æ¸¸æˆå¤§å…</h2>
            
            <div class="form-group">
                <label>ä½ çš„æ˜µç§°</label>
                <input type="text" id="playerName" placeholder="è¾“å…¥æ˜µç§°" maxlength="8">
            </div>
            
            <div id="mainMenu" class="btn-row">
                <button class="btn btn-primary" onclick="createRoom()">ğŸ  åˆ›å»ºæˆ¿é—´</button>
                <button class="btn btn-success" onclick="showJoinDialog()">ğŸšª åŠ å…¥æˆ¿é—´</button>
            </div>
            
            <div id="joinDialog" class="hidden">
                <div class="form-group">
                    <label>æˆ¿é—´ç </label>
                    <input type="text" id="roomCodeInput" placeholder="è¾“å…¥4ä½æˆ¿é—´ç " maxlength="4" style="text-transform: uppercase;">
                </div>
                <div class="btn-row">
                    <button class="btn btn-success" onclick="joinRoom()">åŠ å…¥</button>
                    <button class="btn btn-secondary" onclick="hideJoinDialog()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
        
        <!-- æˆ¿é—´ç•Œé¢ -->
        <div id="room" class="lobby hidden">
            <div class="room-info">
                <div style="font-size:0.9em;color:#aaa;">æˆ¿é—´ç </div>
                <div class="room-code" id="displayRoomCode">----</div>
                <div style="font-size:0.8em;color:#888;margin-top:5px;">åˆ†äº«ç»™æœ‹å‹åŠ å…¥</div>
            </div>
            
            <h2 style="font-size:1.1em;text-align:center;margin-bottom:10px;">é€‰æ‹©åº§ä½</h2>
            
            <div class="seats-container" id="seatsContainer"></div>
            
            <div class="btn-row">
                <button class="btn btn-success" id="readyBtn" onclick="toggleReady()">å‡†å¤‡</button>
                <button class="btn btn-primary" id="startBtn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
                <button class="btn btn-danger" onclick="leaveRoom()">ç¦»å¼€</button>
            </div>
        </div>
        
        <!-- æ¸¸æˆç•Œé¢ -->
        <div id="game" class="game-table hidden">
            <div class="message" id="gameMessage">ç­‰å¾…æ¸¸æˆå¼€å§‹...</div>
            
            <div class="table">
                <div class="phase-indicator" id="phaseIndicator">ç¿»ç‰Œå‰</div>
                
                <div class="players-grid" id="gamePlayers"></div>
                
                <div class="community-cards">
                    <div style="color: #ffd700; font-size: 0.9em; margin-bottom: 5px;">å…¬å…±ç‰Œ</div>
                    <div class="cards" id="communityCards"></div>
                    <div class="pot" id="potDisplay">åº•æ± : 0</div>
                </div>
            </div>
            
            <div class="controls" id="gameControls">
                <div class="controls-row">
                    <button class="btn" disabled>ç­‰å¾…ä¸­...</button>
                </div>
            </div>
            
            <!-- åŠ æ³¨æ»‘å—å¼¹çª— -->
            <div id="raiseModal" class="raise-modal hidden">
                <div class="raise-modal-content">
                    <div class="raise-title">é€‰æ‹©åŠ æ³¨é‡‘é¢</div>
                    <div class="raise-amount" id="raiseAmountDisplay">0</div>
                    <input type="range" id="raiseSlider" class="raise-slider" min="0" max="1000" value="0">
                    <div class="raise-range">
                        <span id="raiseMin">0</span>
                        <span id="raiseMax">0</span>
                    </div>
                    <div class="raise-presets" id="raisePresets"></div>
                    <div class="raise-buttons">
                        <button class="btn btn-secondary" onclick="hideRaiseModal()">å–æ¶ˆ</button>
                        <button class="btn btn-success" onclick="confirmRaise()">ç¡®è®¤åŠ æ³¨</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
        // é…ç½® Socket.IO è‡ªåŠ¨é‡è¿
        const socket = io({
            reconnection: true,
            reconnectionAttempts: 10,
            reconnectionDelay: 1000,
            reconnectionDelayMax: 5000,
            timeout: 20000
        });
        let currentRoomCode = null;
        let myPlayerId = null;
        let isHost = false;
        let gameState = null;
        let roomData = null;
        let playerName = '';
        
        // æ˜¾ç¤ºè¿æ¥çŠ¶æ€æç¤º
        function showConnectionStatus(status) {
            const msg = document.getElementById('gameMessage') || document.querySelector('.message');
            if (msg) {
                if (status === 'disconnected') {
                    msg.textContent = 'âš ï¸ è¿æ¥å·²æ–­å¼€ï¼Œæ­£åœ¨é‡è¿...';
                    msg.style.color = '#ff6b6b';
                } else if (status === 'reconnecting') {
                    msg.textContent = 'ğŸ”„ æ­£åœ¨é‡æ–°è¿æ¥...';
                    msg.style.color = '#ffd700';
                } else if (status === 'connected') {
                    msg.style.color = '';
                }
            }
        }
        
        // Socket.IO äº‹ä»¶
        socket.on('connect', () => {
            console.log('å·²è¿æ¥åˆ°æœåŠ¡å™¨');
            showConnectionStatus('connected');
            // å¦‚æœä¹‹å‰åœ¨æˆ¿é—´æˆ–æ¸¸æˆä¸­ï¼Œå°è¯•é‡æ–°åŠ å…¥
            if (currentRoomCode && playerName) {
                socket.emit('rejoinRoom', { name: playerName, roomCode: currentRoomCode });
            }
        });
        
        socket.on('disconnect', () => {
            console.log('ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥');
            showConnectionStatus('disconnected');
        });
        
        socket.on('reconnecting', (attemptNumber) => {
            console.log(`æ­£åœ¨é‡è¿ (${attemptNumber})`);
            showConnectionStatus('reconnecting');
        });
        
        socket.on('reconnect', (attemptNumber) => {
            console.log(`é‡è¿æˆåŠŸ (${attemptNumber})`);
            showConnectionStatus('connected');
        });
        
        socket.on('reconnect_failed', () => {
            console.log('é‡è¿å¤±è´¥');
            alert('è¿æ¥å·²æ–­å¼€ï¼Œè¯·åˆ·æ–°é¡µé¢é‡æ–°è¿›å…¥');
        });
        
        // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶æ£€æŸ¥è¿æ¥
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                console.log('é¡µé¢é‡æ–°å¯è§ï¼Œæ£€æŸ¥è¿æ¥çŠ¶æ€');
                if (!socket.connected) {
                    socket.connect();
                }
            }
        });
        
        // AIåç§°åˆ—è¡¨
        const aiNames = ['å°æ˜', 'å°çº¢', 'è€ç‹', 'é˜¿å¼º', 'å°ç¾'];
        
        // åˆ›å»ºæˆ¿é—´
        function createRoom() {
            playerName = document.getElementById('playerName').value.trim() || 'ç©å®¶';
            socket.emit('createRoom', { name: playerName });
        }
        
        function showJoinDialog() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('joinDialog').classList.remove('hidden');
        }
        
        function hideJoinDialog() {
            document.getElementById('mainMenu').classList.remove('hidden');
            document.getElementById('joinDialog').classList.add('hidden');
        }
        
        function joinRoom() {
            playerName = document.getElementById('playerName').value.trim() || 'ç©å®¶';
            const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
            
            if (roomCode.length !== 4) {
                alert('è¯·è¾“å…¥4ä½æˆ¿é—´ç ');
                return;
            }
            
            socket.emit('joinRoom', { name: playerName, roomCode });
        }
        
        function leaveRoom() {
            socket.disconnect();
            location.reload();
        }
        
        // é€‰æ‹©åº§ä½
        function selectSeat(seatIndex) {
            socket.emit('selectSeat', { roomCode: currentRoomCode, seatIndex });
        }
        
        // æ·»åŠ AI
        function addAI(seatIndex) {
            socket.emit('addAI', { roomCode: currentRoomCode, seatIndex });
        }
        
        // ç§»é™¤AI
        function removeAI(seatIndex) {
            socket.emit('removeAI', { roomCode: currentRoomCode, seatIndex });
        }
        
        // å‡†å¤‡
        function toggleReady() {
            socket.emit('ready', { roomCode: currentRoomCode });
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            socket.emit('startGame', { roomCode: currentRoomCode });
        }
        
        // Socketäº‹ä»¶
        socket.on('roomCreated', (data) => {
            currentRoomCode = data.roomCode;
            myPlayerId = data.playerId;
            isHost = true;
            showRoom();
        });
        
        socket.on('roomJoined', (data) => {
            currentRoomCode = data.roomCode;
            myPlayerId = data.playerId;
            // å¦‚æœæ¸¸æˆæ­£åœ¨è¿›è¡Œï¼Œç›´æ¥åˆ‡æ¢åˆ°æ¸¸æˆç•Œé¢
            if (data.gameActive) {
                showGame();
            } else {
                showRoom();
            }
        });
        
        socket.on('roomUpdate', (data) => {
            roomData = data;
            updateRoomUI(data);
        });
        
        socket.on('gameState', (data) => {
            gameState = data;
            // å¦‚æœæ¸¸æˆæ­£åœ¨è¿›è¡Œä¸”ä¸åœ¨æ¸¸æˆç•Œé¢ï¼Œåˆ‡æ¢è¿‡å»
            if (gameState.gameActive) {
                showGame();
            }
            updateGameUI();
        });
        
        socket.on('error', (data) => {
            alert(data.message);
        });
        
        function showRoom() {
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('room').classList.remove('hidden');
            document.getElementById('game').classList.add('hidden');
            document.getElementById('displayRoomCode').textContent = currentRoomCode;
        }
        
        function showGame() {
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('room').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            document.getElementById('game').classList.add('active');
        }
        
        function updateRoomUI(data) {
            const container = document.getElementById('seatsContainer');
            let html = '';
            
            for (let i = 0; i < 6; i++) {
                const player = data.seats[i];
                const isMySeat = player && player.id === myPlayerId;
                
                if (player) {
                    // åº§ä½å·²è¢«å ç”¨
                    const seatClass = isMySeat ? 'your-seat' : (player.isAI ? 'ai-seat' : 'occupied');
                    const typeLabel = player.isAI ? 'ğŸ¤– ç”µè„‘' : 'ğŸ‘¤ ç©å®¶';
                    const statusText = player.ready ? 'âœ… å·²å‡†å¤‡' : 'â³ æœªå‡†å¤‡';
                    const connStatus = player.isAI ? '' : (player.connected ? '<span style="color:#4CAF50;">â— åœ¨çº¿</span>' : '<span style="color:#f44336;">â— æ–­çº¿</span>');
                    
                    html += `
                        <div class="seat ${seatClass}">
                            <div class="player-name">${player.name}${isMySeat ? ' (ä½ )' : ''}</div>
                            <div class="player-type">${typeLabel} ${connStatus}</div>
                            <div class="player-chips">ğŸ’° ${player.chips}</div>
                            <div class="player-status">${statusText}</div>
                            ${player.isAI && isHost ? `<div class="seat-actions"><button class="btn btn-small btn-danger" onclick="removeAI(${i})">ç§»é™¤</button></div>` : ''}
                        </div>
                    `;
                } else {
                    // ç©ºåº§ä½
                    html += `
                        <div class="seat waiting">
                            <div style="color:#666;">åº§ä½ ${i + 1}</div>
                            <div style="font-size:0.8em;color:#555;margin:5px 0;">ç©ºä½</div>
                            <div class="seat-actions">
                                <button class="btn btn-small btn-primary" onclick="selectSeat(${i})">åä¸‹</button>
                                ${isHost ? `<button class="btn btn-small btn-secondary" onclick="addAI(${i})">+AI</button>` : ''}
                            </div>
                        </div>
                    `;
                }
            }
            
            container.innerHTML = html;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const me = data.seats.find(s => s && s.id === myPlayerId);
            if (me) {
                document.getElementById('readyBtn').textContent = me.ready ? 'å–æ¶ˆå‡†å¤‡' : 'å‡†å¤‡';
                document.getElementById('readyBtn').classList.toggle('btn-warning', me.ready);
                document.getElementById('readyBtn').classList.toggle('btn-success', !me.ready);
            }
            
            // åªæœ‰æˆ¿ä¸»èƒ½å¼€å§‹ï¼Œä¸”è‡³å°‘2äºº
            const occupiedSeats = data.seats.filter(s => s !== null);
            const allReady = occupiedSeats.every(s => s.ready);
            document.getElementById('startBtn').style.display = (isHost && occupiedSeats.length >= 2 && allReady) ? 'inline-block' : 'none';
        }
        
        function updateGameUI() {
            document.getElementById('room').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            document.getElementById('game').classList.add('active');
            
            if (!gameState) return;
            
            // é˜¶æ®µåç§°
            const phaseNames = {
                'waiting': 'ç­‰å¾…ä¸­',
                'preflop': 'ç¿»ç‰Œå‰',
                'flop': 'ç¿»ç‰Œ',
                'turn': 'è½¬ç‰Œ',
                'river': 'æ²³ç‰Œ',
                'showdown': 'æ‘Šç‰Œ',
                'finished': 'æ¸¸æˆç»“æŸ'
            };
            document.getElementById('phaseIndicator').textContent = phaseNames[gameState.phase] || gameState.phase;
            
            // ç©å®¶åˆ—è¡¨
            const playersGrid = document.getElementById('gamePlayers');
            const isGameOver = gameState.phase === 'finished' || gameState.phase === 'showdown';
            
            // æ‰¾åˆ°å½“å‰ç©å®¶
            const myPlayer = gameState.players.find(p => p && p.id === myPlayerId);
            const myHandType = myPlayer && myPlayer.handType ? myPlayer.handType : '';
            
            playersGrid.innerHTML = gameState.players.map((p, i) => {
                if (!p) return '<div class="game-player" style="opacity:0.3;"><div style="color:#666;">ç©ºä½</div></div>';
                
                const isCurrent = i === gameState.currentPlayerIndex;
                const isMe = p.id === myPlayerId;
                const cardsHtml = p.hand ? p.hand.map(c => 
                    c.hidden ? '<div class="card hidden">?</div>' :
                    `<div class="card ${c.suit === 'â™¥' || c.suit === 'â™¦' ? 'red' : 'black'}">${c.suit}${c.rank}</div>`
                ).join('') : '';
                
                // æ¸¸æˆç»“æŸæ—¶äº®ç‰Œï¼ˆåŒ…æ‹¬å¼ƒç‰Œç©å®¶ï¼‰
                const showCards = isMe || isGameOver;
                
                // ä¸‹æ³¨æ˜¾ç¤ºï¼šè¿‡ç‰Œæ—¶æ˜¾ç¤º"è¿‡ç‰Œ"ï¼Œæœ‰ä¸‹æ³¨æ˜¾ç¤ºé‡‘é¢
                let betText = '';
                if (p.folded) {
                    betText = 'å·²å¼ƒç‰Œ';
                } else if (p.isAllIn) {
                    betText = 'All In!';
                } else if (p.bet === 0) {
                    betText = 'è¿‡ç‰Œ';
                } else {
                    betText = `ä¸‹æ³¨: ${p.bet}`;
                }
                
                // ç‰Œå‹æ˜¾ç¤ºï¼šæ¸¸æˆä¸­åªæ˜¾ç¤ºè‡ªå·±çš„ï¼Œç»“æŸæ—¶æ˜¾ç¤ºæ‰€æœ‰äººçš„
                let handTypeHtml = '';
                if (isGameOver && p.handType) {
                    handTypeHtml = `<div style="font-size:0.8em;color:#4CAF50;font-weight:bold;">${p.handType}</div>`;
                } else if (isMe && myHandType && gameState.communityCards && gameState.communityCards.length > 0) {
                    handTypeHtml = `<div style="font-size:0.8em;color:#4CAF50;font-weight:bold;">${myHandType}</div>`;
                }
                
                // è¿æ¥çŠ¶æ€
                const connStatus = p.isAI ? '' : (p.connected ? '<span style="color:#4CAF70;">â—</span>' : '<span style="color:#f44336;">â—æ–­çº¿</span>');
                
                return `
                    <div class="game-player ${isCurrent ? 'current' : ''} ${p.folded ? 'folded' : ''} ${p.isAI ? 'is-ai' : ''}">
                        <div style="font-weight:bold;">${connStatus} ${p.name}${isMe ? ' (ä½ )' : ''}${p.isAI ? ' ğŸ¤–' : ''}</div>
                        <div style="font-size:0.8em;color:#ffd700;">ğŸ’° ${p.chips}</div>
                        <div class="cards">${showCards ? cardsHtml : '<div class="card hidden">?</div><div class="card hidden">?</div>'}</div>
                        ${handTypeHtml}
                        <div style="font-size:0.75em;color:#aaa;">${betText}</div>
                    </div>
                `;
            }).join('');
            
            // å…¬å…±ç‰Œ
            const communityCards = document.getElementById('communityCards');
            communityCards.innerHTML = gameState.communityCards.map(c => 
                `<div class="card ${c.suit === 'â™¥' || c.suit === 'â™¦' ? 'red' : 'black'}">${c.suit}${c.rank}</div>`
            ).join('') || '<div style="color:#666;font-size:0.9em;">ç­‰å¾…å‘ç‰Œ...</div>';
            
            // åº•æ± 
            document.getElementById('potDisplay').textContent = `åº•æ± : ${gameState.pot}`;
            
            // æ¶ˆæ¯
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            let message = '';
            
            if (!gameState.gameActive) {
                // æ¸¸æˆç»“æŸæ—¶æ¶ˆæ¯ä¸ºç©ºï¼ˆè·èƒœä¿¡æ¯æ˜¾ç¤ºåœ¨æŒ‰é’®åŒºåŸŸï¼‰
                message = '';
            } else if (currentPlayer) {
                if (currentPlayer.id === myPlayerId) {
                    message = 'è½®åˆ°ä½ è¡ŒåŠ¨ï¼';
                } else {
                    message = `ç­‰å¾… ${currentPlayer.name}${currentPlayer.isAI ? '(AI)' : ''} è¡ŒåŠ¨...`;
                }
            }
            
            document.getElementById('gameMessage').textContent = message;
            
            // æ§åˆ¶æŒ‰é’®
            updateControls();
        }
        
        function updateControls() {
            const controls = document.getElementById('gameControls');
            
            if (!gameState || !gameState.gameActive) {
                // æ¸¸æˆç»“æŸï¼Œæ˜¾ç¤ºè·èƒœä¿¡æ¯ + ä¸‹ä¸€å±€å’Œè¿”å›æˆ¿é—´æŒ‰é’®
                let winnerHtml = '';
                if (gameState && gameState.winner && gameState.winner.name) {
                    const handType = gameState.winner.handType ? ` (${gameState.winner.handType})` : '';
                    if (gameState.winner.isTie) {
                        // å¹³å±€
                        winnerHtml = `<div style="font-size:1.3em;color:#ffd700;margin-bottom:15px;">ğŸ¤ å¹³å±€ï¼${gameState.winner.name}${handType}<br/>å„èµ¢å¾— ${gameState.winner.pot} ç­¹ç ï¼</div>`;
                    } else {
                        const isMe = gameState.players && gameState.players.find(p => p && p.id === myPlayerId && p.name === gameState.winner.name);
                        winnerHtml = `<div style="font-size:1.3em;color:#ffd700;margin-bottom:15px;">${isMe ? 'ğŸ‰ ä½ è·èƒœäº†ï¼' : `ğŸ‰ ${gameState.winner.name} è·èƒœï¼`}${handType}<br/>èµ¢å¾— ${gameState.winner.pot} ç­¹ç ï¼</div>`;
                    }
                }
                
                controls.innerHTML = `
                    <div class="controls-row" style="flex-direction:column;align-items:center;">
                        ${winnerHtml}
                        <div>
                            <button class="btn btn-primary" onclick="startNextGame()" style="background:#4CAF50;margin-right:10px;">ä¸‹ä¸€å±€</button>
                            <button class="btn" onclick="backToRoom()">è¿”å›æˆ¿é—´</button>
                        </div>
                    </div>
                `;
                return;
            }
            
            const myIndex = gameState.players.findIndex(p => p && p.id === myPlayerId);
            if (myIndex === -1 || gameState.currentPlayerIndex !== myIndex) {
                controls.innerHTML = `
                    <div class="controls-row">
                        <button class="btn" disabled>ç­‰å¾…å…¶ä»–ç©å®¶...</button>
                    </div>
                `;
                return;
            }
            
            const me = gameState.players[myIndex];
            const toCall = gameState.currentBet - me.bet;
            
            let html = '<div class="controls-row">';
            
            if (toCall > 0) {
                if (toCall >= me.chips) {
                    html += `<button class="btn call-btn" onclick="playerAction('call')">All in (${me.chips})</button>`;
                } else {
                    html += `<button class="btn call-btn" onclick="playerAction('call')">è·Ÿæ³¨ ${toCall}</button>`;
                }
            } else {
                html += `<button class="btn check-btn" onclick="playerAction('check')">è¿‡ç‰Œ</button>`;
            }
            
            const minRaise = gameState.currentBet + gameState.bigBlind;
            if (me.chips > toCall) {
                html += `<button class="btn raise-btn" onclick="showRaise()">åŠ æ³¨</button>`;
            }
            
            html += `<button class="btn fold-btn" onclick="playerAction('fold')">å¼ƒç‰Œ</button>`;
            html += '</div>';
            
            controls.innerHTML = html;
        }
        
        function showRaise() {
            const me = gameState.players.find(p => p && p.id === myPlayerId);
            const minRaise = gameState.currentBet + gameState.bigBlind;
            const maxRaise = me.chips + me.bet;
            
            const slider = document.getElementById('raiseSlider');
            const amountDisplay = document.getElementById('raiseAmountDisplay');
            const minDisplay = document.getElementById('raiseMin');
            const maxDisplay = document.getElementById('raiseMax');
            const presetsContainer = document.getElementById('raisePresets');
            
            slider.min = minRaise;
            slider.max = maxRaise;
            slider.value = minRaise;
            
            minDisplay.textContent = minRaise;
            maxDisplay.textContent = maxRaise;
            amountDisplay.textContent = minRaise;
            
            // ç”Ÿæˆå¿«æ·æŒ‰é’®
            const presets = [
                { label: 'æœ€å°', value: minRaise },
                { label: '1/2åº•æ± ', value: Math.min(maxRaise, Math.floor(gameState.pot / 2 + me.bet)) },
                { label: 'åº•æ± ', value: Math.min(maxRaise, gameState.pot + me.bet) },
                { label: 'All in', value: maxRaise }
            ];
            
            presetsContainer.innerHTML = presets.map(p => 
                `<button class="raise-preset-btn" onclick="setRaiseAmount(${p.value})">${p.label}</button>`
            ).join('');
            
            // æ»‘å—å˜åŒ–äº‹ä»¶
            slider.oninput = function() {
                amountDisplay.textContent = this.value;
            };
            
            document.getElementById('raiseModal').classList.remove('hidden');
        }
        
        function setRaiseAmount(value) {
            const slider = document.getElementById('raiseSlider');
            const amountDisplay = document.getElementById('raiseAmountDisplay');
            slider.value = value;
            amountDisplay.textContent = value;
        }
        
        function hideRaiseModal() {
            document.getElementById('raiseModal').classList.add('hidden');
        }
        
        function confirmRaise() {
            const amount = parseInt(document.getElementById('raiseSlider').value);
            hideRaiseModal();
            playerAction('raise', amount);
        }
        
        function playerAction(action, amount = 0) {
            socket.emit('playerAction', {
                roomCode: currentRoomCode,
                action,
                amount
            });
        }
        
        function startNextGame() {
            socket.emit('startNextGame', currentRoomCode);
        }
        
        function backToRoom() {
            document.getElementById('game').classList.add('hidden');
            document.getElementById('room').classList.remove('hidden');
        }
    </script>
</body>
</html>
